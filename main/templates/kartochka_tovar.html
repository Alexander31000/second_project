{% extends 'main.html' %}
{% load static %}

{% block css%}
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}"/>
{% endblock css%}

{% block main %}
<main class="product-page" id="productPage">


    <section class="product-detail" aria-labelledby="productTitle">
        <!-- Slider -->
        <div class="gallery">
            <div class="slider" id="slider" aria-roledescription="carousel">
                <div class="slider-track" id="sliderTrack">
                    {% if tovar.img %}
                    <!--              добавление главной картинки в слайде-->
                    <div class="slide" data-src="{{ tovar.img.url }}">
                        <img src="{{ tovar.img.url }}" loading="lazy">
                    </div>
                    {% endif %}
                    {% for img in tovar_imgs %}
                    <div class="slide" data-src="{{ img.img.url }}">
                        <img src="{{ img.img.url }}" loading="lazy">
                    </div>
                    {% endfor %}
                </div>

                <button class="slider-btn prev" id="sliderPrev" aria-label="Предыдущее">‹</button>
                <button class="slider-btn next" id="sliderNext" aria-label="Следующее">›</button>

                <div class="slider-dots" id="sliderDots" role="tablist" aria-label="Навигация слайдов"></div>

                <button class="slider-play" id="sliderPlay" aria-label="Пауза автопрокрутки">⏸️</button>
            </div>

            <div class="thumbs" id="thumbs" role="tablist" aria-label="Миниатюры">
                {% if tovar.img %}
                <button class="thumb active" data-index="0" aria-label="Миниатюра 1">
                    <img src="{{ tovar.img.url }}" loading="lazy">
                </button>
                {% endif %}
                {% for img in tovar.tovarimage_set.all %}
                <button class="thumb" data-index="{{ forloop.counter0|add:1 }}"
                        aria-label="Миниатюра {{ forloop.counter|add:1 }}">
                    <img src="{{ img.img.url }}" loading="lazy">
                </button>
                {% endfor %}
            </div>
        </div>

        <!-- Meta -->
        <div class="meta">
            <h1 id="productTitle">{{ tovar.title }}</h1>

            <div class="price-block">
                <div class="price" id="price">{{ tovar.prise|floatformat:2 }} BYN</div>
                <div class="availability in-stock">{% if tovar.pk %}В наличии{% else %}Нет в наличии{% endif %}</div>
            </div>

            <div class="short-desc">
                <p>{{ tovar.opisanie|truncatechars:200 }}</p>
            </div>


            <form id="addToCartForm" action="{% url 'cart_add' tovar.id %}" method="post">
                {% csrf_token %}
                <div class="qty-row">


                {{ cart_product_form }}
                </div>

                <a href="{% url 'redaktor' tovar.id%}" class="add-cart">Редактировать</a>

                <div class="actions">
                    <button id="addToCartBtn" class="add-cart" type="submit" data-product="{{ product.pk }}">Добавить в
                        корзину
                    </button>
                    <a class="buy-now" href="#">Купить сейчас</a>
                </div>
            </form>

            <details class="product-specs">
                <summary>Полное описание</summary>
                <div class="specs-body">{{ tovar.opisanie|linebreaks }}</div>
                <div class="specs-body">{{ tovar.prise|linebreaks }}</div>
            </details>

            <div class="share">
                <span>Поделиться</span>
                <a href="https://t.me/share/url?url={{ request.build_absolute_uri|urlencode }}&text={{ product.title|urlencode }}"
                   target="_blank" rel="noopener">Telegram</a>
                <a href="https://vk.com/share.php?url={{ request.build_absolute_uri|urlencode }}" target="_blank"
                   rel="noopener">VK</a>
            </div>
        </div>
    </section>


    <section class="related-products" aria-labelledby="relatedTitle">
        <h2 id="relatedTitle">Похожие товары</h2>
        <div class="related-grid">
            {% for rp in related_products %}
            <article class="related-card">
                <a href="{% url 'product:detail' rp.pk %}">
                    {% if rp.img %}
                    <img src="{{ rp.img.url }}" alt="{{ rp.title }}" loading="lazy">
                    {% else %}
                    <img src="{% static 'img/placeholder.png' %}" alt="{{ rp.title }}" loading="lazy">
                    {% endif %}
                    <div class="related-title">{{ rp.title }}</div>
                    <div class="related-price">{{ rp.price|floatformat:2 }} ₽</div>
                </a>
            </article>
            {% empty %}
            <p>Похожие товары отсутствуют.</p>
            {% endfor %}
        </div>
    </section>
</main>

{% endblock main%}

{% block js %}
<script src="{% static 'js/product_detail.js'%}" defer></script>
{% endblock js%}



